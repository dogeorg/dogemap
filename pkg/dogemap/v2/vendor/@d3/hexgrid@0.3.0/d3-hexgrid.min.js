!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3={})}(this,function(t){"use strict";function e(t,n){return t<n?-1:n<t?1:n<=t?0:NaN}var n,r;1===(n=e).length&&(r=n,n=function(t,n){return e(r(t),n)});function h(t){return null===t?NaN:+t}function o(t,n,e){return e<=t?t:(console.warn(n+" should be "+e+" or greater. Coerced to "+e+"."),e)}function i(){return new a}function a(){this.reset()}a.prototype={constructor:a,reset:function(){this.s=this.t=0},add:function(t){c(u,t,this.t),c(this,u.s,this.s),this.s?this.t+=u.t:this.s=u.t},valueOf:function(){return this.s}};var u=new a;function c(t,n,e){var r=t.s=n+e,o=r-n,i=r-o;t.t=n-i+(e-o)}var f=1e-6,s=Math.PI,l=s/2,v=2*s,d=180/s,g=s/180,p=Math.atan2,y=Math.cos,m=Math.sin,x=Math.sqrt;function M(t){return 1<t?l:t<-1?-l:Math.asin(t)}i(),i();i();function P(t){return function(){return t}}function w(t,n){return[s<t?t-v:t<-s?t+v:t,n]}function k(e){return function(t,n){return[s<(t+=e)?t-v:t<-s?t+v:t,n]}}function b(t){var n=k(t);return n.invert=k(-t),n}function C(t,n){var u=y(t),c=m(t),l=y(n),f=m(n);function e(t,n){var e=y(n),r=y(t)*e,o=m(t)*e,i=m(n),a=i*u+r*c;return[p(o*l-a*f,r*u-i*c),M(a*l+o*f)]}return e.invert=function(t,n){var e=y(n),r=y(t)*e,o=m(t)*e,i=m(n),a=i*l-o*f;return[p(o*l+i*f,r*u+a*c),M(a*u-r*c)]},e}function E(t,n){var e,r,o,i,a,u;r=(e=n)[0],o=e[1],(n=[(i=y(o))*y(r),i*m(r),m(o)])[0]-=t,u=x((a=n)[0]*a[0]+a[1]*a[1]+a[2]*a[2]),a[0]/=u,a[1]/=u,a[2]/=u;var c,l=1<(c=-n[1])?0:c<-1?s:Math.acos(c);return((-n[2]<0?-l:l)+v-f)%v}function D(){var a,u,c=P([0,0]),l=P(90),f=P(6),s={point:function(t,n){a.push(t=u(t,n)),t[0]*=d,t[1]*=d}};function n(){var t,n,e,r=c.apply(this,arguments),o=l.apply(this,arguments)*g,i=f.apply(this,arguments)*g;return a=[],u=(t=-r[0]*g,n=-r[1]*g,e=0,(t%=v)?n||e?function(e,r){function t(t,n){return t=e(t,n),r(t[0],t[1])}return e.invert&&r.invert&&(t.invert=function(t,n){return(t=r.invert(t,n))&&e.invert(t[0],t[1])}),t}(b(t),C(n,e)):b(t):n||e?C(n,e):w).invert,function(t,n,e,r,o,i){if(e){var a,u=y(n),c=m(n),l=r*e;null==o?(o=n+r*v,i=n-l/2):(o=E(u,o),i=E(u,i),(0<r?o<i:i<o)&&(o+=r*v));for(var f,s=o;0<r?i<s:s<i;s-=l)a=[u,-c*y(s),-c*m(s)],f=[p(a[1],a[0]),M(a[2])],t.point(f[0],f[1])}}(s,o,i,1),r={type:"Polygon",coordinates:[a]},a=u=null,r}return n.center=function(t){return arguments.length?(c="function"==typeof t?t:P([+t[0],+t[1]]),n):c},n.radius=function(t){return arguments.length?(l="function"==typeof t?t:P(+t),n):l},n.precision=function(t){return arguments.length?(f="function"==typeof t?t:P(+t),n):f},n}w.invert=w;i(),i(),i(),i(),i();function N(t,n,e,r){var o,i,a,u=t/("m"===function(t){var n=t.toLowerCase();if("m"===n||"km"===n)return n;if("kilometres"===n||"kilometre"===n||"kilometers"===n||"kilometer"===n)n="km";else{if("miles"!==n&&"mile"!==n)throw new Error('Please provide the unit identifier as either "km" for kilometres or "m" for miles');n="m"}return n}(n)?3959:6371)*(180/Math.PI),c=D().radius(u).center(e.invert(r)),l=(o=c(),i=e,((a=function(t,n){var e,r,o,i=t.length,a=-1;if(null==n){for(;++a<i;)if(null!=(e=t[a])&&e<=e)for(r=o=e;++a<i;)null!=(e=t[a])&&(e<r&&(r=e),o<e&&(o=e))}else for(;++a<i;)if(null!=(e=n(t[a],a,t))&&e<=e)for(r=o=e;++a<i;)null!=(e=n(t[a],a,t))&&(e<r&&(r=e),o<e&&(o=e));return[r,o]}(o.coordinates[0].map(function(t){return i(t)[1]})))[1]-a[0])/2);return{circlePolygon:c,radiusDegrees:u,radiusPixel:l}}var I=Math.PI/3,j=[0,I,2*I,3*I,4*I,5*I];function W(t){return t[0]}function O(t){return t[1]}function S(t,n){return function(){var i,m,x,a=0,u=0,c=1,l=1,M=W,P=O;function e(t){var n,e={},r=[],o=t.length;for(n=0;n<o;++n)if(!isNaN(a=+M.call(null,i=t[n],n,t))&&!isNaN(u=+P.call(null,i,n,t))){var i,a,u,c=Math.round(u/=x),l=Math.round(a=a/m-(1&c)/2),f=u-c;if(1<3*Math.abs(f)){var s=a-l,h=l+(a<l?-1:1)/2,v=c+(u<c?-1:1),d=a-h,g=u-v;d*d+g*g<s*s+f*f&&(l=h+(1&c?1:-1)/2,c=v)}var p=l+"-"+c,y=e[p];y?y.push(i):(r.push(y=e[p]=[i]),y.x=(l+(1&c)/2)*m,y.y=c*x)}return r}function r(i){var a=0,u=0;return j.map(function(t){var n=Math.sin(t)*i,e=-Math.cos(t)*i,r=n-a,o=e-u;return a=n,u=e,[r,o]})}return e.hexagon=function(t){return"m"+r(null==t?i:+t).join("l")+"z"},e.centers=function(){for(var t=[],n=Math.round(u/x),e=Math.round(a/m),r=n*x;r<l+i;r+=x,++n)for(var o=e*m+(1&n)*m/2;o<c+m/2;o+=m)t.push([o,r]);return t},e.mesh=function(){var n=r(i).slice(0,4).join("l");return e.centers().map(function(t){return"M"+t+"m"+n}).join("")},e.x=function(t){return arguments.length?(M=t,e):M},e.y=function(t){return arguments.length?(P=t,e):P},e.radius=function(t){return arguments.length?(m=2*(i=+t)*Math.sin(I),x=1.5*i,e):i},e.size=function(t){return arguments.length?(a=u=0,c=+t[0],l=+t[1],e):[c-a,l-u]},e.extent=function(t){return arguments.length?(a=+t[0][0],u=+t[0][1],c=+t[1][0],l=+t[1][1],e):[[a,u],[c,l]]},e.radius(1)}().extent(t).radius(n).x(function(t){return t.x}).y(function(t){return t.y})}var A=function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function G(t,n,e,r,o,i){var a=i*r,u=a+2*r,c=document.createElement("canvas"),l=A(t,2);c.width=l[0],c.height=l[1];var f=c.getContext("2d"),s=n.context(f);return f.beginPath(),s(e),"fill"===o?(i&&(f.lineWidth=a,f.stroke()),f.fill()):"stroke"===o&&(f.lineWidth=u,f.stroke()),n.context(null),f.getImageData(0,0,t[0],t[1]).data.filter(function(t,n){return n%4==3})}function q(t,n,e,r,o,i){var a=Math.sqrt(3)*o*t,u=2*o*t,c=document.createElement("canvas");c.width=a,c.height=u;for(var l,f,s,h,v,d=c.getContext("2d"),g=Array(7),p=0;p<7;p++){var y=(l={x:0,y:0},f=o*t,s=void 0,s={},h=60*p-30,v=Math.PI/180*h,s.x=l.x+f*Math.cos(v),s.y=l.y+f*Math.sin(v),s);g[p]=y}d.translate(a/2,u/2),function(n,t,e){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"fill";if(n.beginPath(),t.forEach(function(t){0===t?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y)}),n.closePath(),"fill"===r)n.fillStyle=e,n.fill();else{if("stroke"!==r)throw new Error("hexDraw action needs to be either 'fill' or 'stroke'");n.strokeStyle=e,n.stroke()}}(d,g,"red","fill");var m=A(n,2),x=m[0],M=m[1],P=document.createElement("canvas");P.width=x*t,P.height=M*t;var w=P.getContext("2d");e.context(w);var k=i*o;w.scale(t,t),w.beginPath(),e(r),w.lineWidth=k,w.fillStyle="blue",w.strokeStyle="blue",w.stroke(),w.fill(),e.context(null);var b=document.createElement("canvas");return b.width=a,b.height=u,{canvasHex:c,canvasImage:P,contextMix:b.getContext("2d")}}function z(t,o,n,i){if(!t.length)return[];var a=function(t,n){if(t&&2===t.length)return t;var e=Object.keys(n[0]).filter(function(t){var n=t.toLowerCase();return"longitude"===n||"lon"===n||"lng"===n||"long"===n||"lambda"===n}),r=Object.keys(n[0]).filter(function(t){var n=t.toLowerCase();return"latitude"===n||"lat"===n||"phi"===n});return[e[0],r[0]]}(n,t);return t.map(function(n){var t=o([+n[a[0]],+n[a[1]]]),e={},r=A(t,2);return e.x=r[0],e.y=r[1],i&&i.length&&i.forEach(function(t){e[t]=n[t]}),e})}function F(t,n){for(var e=function(t,n,e){if(null==e&&(e=h),r=t.length){if((n=+n)<=0||r<2)return+e(t[0],0,t);if(1<=n)return+e(t[r-1],r-1,t);var r,o=(r-1)*n,i=Math.floor(o),a=+e(t[i],i,t);return a+(+e(t[i+1],i+1,t)-a)*(o-i)}}(t.filter(function(t){return 0<t.cover&&t.cover<1}).map(function(t){return t.cover}).sort(function(t,n){return t-n}),.1),r=1.5*Math.sqrt(3)*Math.pow(n,2),o=0,i=0,a=0,u=t.length,c=t.length,l=t.length/r,f=0;f<t.length;f++){var s=t[f];s.cover||(s.cover=e),s.datapointsWt=s.datapoints*(1/s.cover),s.pointDensity=s.datapoints/(r*s.cover),o=Math.max(o,s.datapoints),i=Math.max(i,s.datapointsWt),a=Math.max(a,s.pointDensity),0<s.datapoints&&(u=Math.min(u,s.datapoints),c=Math.min(c,s.datapointsWt)),0<s.pointDensity&&(l=Math.min(l,s.pointDensity))}return{layout:t,extentPoints:[u,o],extentPointsWeighted:[c,i],extentPointDensity:[l,a]}}t.hexgrid=function(){var P=void 0,w=void 0,k=void 0,b=void 0,C=4,E=null,D=null,I=1,j=0,W=void 0,r=function(t,n){if(D){var e=N(D,E,k,P[1].map(function(t){return t/2}));C=e.radiusPixel}C=Math.round(2*C)/2,console.log(C);var r,o,i,a,u,c,l,f,s=S(P,C),h=s.size(),v=s.centers(),d=G(h,b,w,C,"fill",j),g=(r=v,o=d,i=A(h,2),a=i[0],u=i[1],r.filter(function(t){return 0<=t[0]&&t[0]<=a&&0<=t[1]&&t[1]<=u&&o[Math.floor(t[0])+Math.floor(t[1])*Math.floor(a)]}).map(function(t,n){return{id:n,x:t[0],y:t[1],gridpoint:1,cover:1}})),p=G(h,b,w,C,"stroke",j),y=(c=g,l=p,f=h[0],c.filter(function(t){return l[Math.floor(t.x)+f*Math.floor(t.y)]})),m=q(I,h,b,w,C,j);g=function(t,n){for(var e=t.slice(0),r=0;r<n.length;r++){var o=n[r];e[o.id].cover=o.cover}return e}(g,y.map(function(t){return function(t,n,e,r){var o=n.canvasHex,i=n.canvasImage,a=n.contextMix,u=o.width,c=o.height;a.drawImage(o,0,0),a.globalCompositeOperation="source-atop",a.drawImage(i,-t.x*e+u/2,-t.y*e+c/2);for(var l=a.getImageData(0,0,u,c).data,f=0,s=0,h=3;h<l.length;h+=4)if(!(l[h]<100)){var v=l[h-3];l[h-1]<v?f++:s++}var d=s/(f+s),g=Object.assign({},t);return g.cover=d,a.clearRect(0,0,u,c),a.globalCompositeOperation="source-over",g}(t,m,I)}));var x=z(t,k,W,n),M=function(t){for(var n=0;n<t.length;n++){for(var e=t[n],r=void 0,o=void 0,i=0;i<e.length;i++)1===e[i].gridpoint&&(r=e[i].cover,o=1,e.splice(i,1));t[n].datapoints=t[n].length,t[n].cover=r,t[n].gridpoint=o||0}return t}(s(g.concat(x)));return M=F(M,C),s.grid={},s.grid.layout=M.layout,s.grid.imageCenters=g,s.grid.extentPoints=M.extentPoints,s.grid.extentPointsWeighted=M.extentPointsWeighted,s.grid.extentPointDensity=M.extentPointDensity,s};return r.extent=function(t){return arguments.length?(P=function(t){var n=Array.from(new Set(t.map(function(t){return t.length})))[0],e=Array(2);if(2===n)e=t;else{if(void 0!==n)throw new Error("Check 'extent' is in the anticipated form [[x0,y0],[x1,y1]] or [x1,y1]");e=[[0,0],t]}return e}(t),r):P},r.geography=function(t){return arguments.length?(w=t,r):w},r.projection=function(t){return arguments.length?(k=t,r):k},r.pathGenerator=function(t){return arguments.length?(b=t,r):b},r.hexRadius=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];if(n.length){if(1===n.length)return C=n[0],r;if(2===n.length)return D=n[0],E=n[1],r;throw new Error('Please pass a numeric radius and optionally a string distance unit ("miles" or "kilometres") to `.hexradius()`')}return E?{radius:C,unit:E}:C},r.edgePrecision=function(t){return arguments.length?(I=o(t,"Edge precision",.3),r):I},r.gridExtend=function(t){return arguments.length?(j=o(t,"Edge band",0),r):j},r.geoKeys=function(t){return arguments.length?(W=t,r):W},r},t.geoPolygon=function(t,n){var e=[],r=void 0;try{if("FeatureCollection"===t.type)r=t.features;else{if("GeometryCollection"!==t.type)throw new Error('Geometry type not supported. Please feed me a "FeatureCollection" or a "GeometryCollection".');r=t.geometries}}catch(t){console.error(t)}for(var o=0;o<r.length;o++){var i="FeatureCollection"===t.type?t.features[o].geometry:t.geometries[o];if(i&&"Polygon"===i.type){var a=i.coordinates[0].map(function(t){return n(180<t[0]?[180,t[1]]:t)});e.push(a)}else{if(!i||"MultiPolygon"!==i.type)continue;var u=i.coordinates.map(function(t){return t[0].map(function(t){return n(180<t[0]?[180,t[1]]:t)})});e=e.concat(u)}}return e},t.polygonPoints=function(r,t){return t.reduce(function(t,n){var e=r.filter(function(t){return function(t,n){for(var e,r,o=t.length,i=t[o-1],a=n[0],u=n[1],c=i[0],l=i[1],f=!1,s=0;s<o;++s)e=(i=t[s])[0],u<(r=i[1])!=u<l&&a<(c-e)*(u-r)/(l-r)+e&&(f=!f),c=e,l=r;return f}(n,[t.x,t.y])});return t.concat(e)},[]).sort(function(t,n){return t.x-n.x||t.y-n.y})},Object.defineProperty(t,"__esModule",{value:!0})});